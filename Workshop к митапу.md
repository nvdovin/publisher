Подготовка к воркшопу по проекту на митапе. Рассказ о проделанной работе и прочее.

## Техническое задание
Подготовить дашборд, который раскроет следующий функционал системы:
- Приоритизация задач из ДБ
- Отправка сообщений из ДБ по процессу
- Постановка задач в АМО СРМ
- Внесение данных через ДБ
- Что-то с Автоалгоритмом с кнопкой из ДБ

В целом, сутью задачи было то, чтобы показать, что в нашей системе можно если не все, то практически все. И при этом это все можно делать прямо из дашборда. Как вы все знаете, такой функционал в нашей системе — предусмотрен.
Давайте перейдем к тому, что в итоге получилось.

## Dashboard
### Главная страница
Демонстрация дашборда начинается с главной страницы. Выглядит она таким образом:

![[Главная страница.png]]

В целом эта страница, это дашборд дашбордов. Это то место, где руководитель может увидеть самую верхнеуровневую информацию по своим проектам, задачам, сделкам и прочее.
Отличительной особенностью этой страницы является то, что здесь выведены _KPI_ показатели для по тем, или иным процессам. В нашем случае, мы рассматриваем 4 бизнес-процесса, или 4 разных сферы жизни компании. 
Также тут видна "превью" дашборда, на который попадет пользователь, чтобы более детально исследовать ту или иную отрасль своебо бизнеса. Ну и, разумеется, кнопка, для перехода к самому дашборду, где продемонстрированы показатели по интересующему процессу.
#### Процессы
Какие процессы, или какие сферы работы компании _N_ можно охватить с помощью этого дашборда?
Как видно из дашборда, это:
- CRM Сделки;
- Задачи;
- Task Mining;
- Улучшение бизнес-процессов.

На первый взгляд все это о разных процессах, о разных направлениях, да и находятся все эти вещи в разных плоскостях, но это не совсем так. 

**Смысл такого подхода:**
- **Концентрация на ключевых задачах:** руководителю не нужно погружаться в детали, достаточно "пробежаться" по главной странице, чтобы быстро оценить общую картину.
- **Удобный доступ к информации:** информация структурирована и доступна для быстрого анализа.

**Пример:**
Допустим, руководитель компании _N_ заходит на главную страницу.
- Он видит, что за последнюю неделю было закрыто 1 сделку из 9. Нажав на "Исследовать", он может перейти на отдельный дашборд по CRM сделкам и подробнее рассмотреть информацию о сделках, такую как историю каждой сделки, фамилию ответственного менеджера, и т.д.
- Или, например, он может перейти к дашборду по задачам и увидеть, что из 10 задач 8 находятся в работе. Он может проверить список задач, увидеть, кто за них ответственен, и при необходимости внести изменения в план.

В итоге, главная страница дашборда предоставляет руководителю краткий и наглядный обзор основных показателей бизнеса, позволяя быстро оценить ситуацию и принять необходимые решения.
### CRM Сделки
Первая страница, которую мы исследуем, это CRM Сделки.

![[CRM Задачи.png]]

В чем смысл ведения этой страницы. Отличительной особенностью этой страницы является то, что отсюда мы можем подключаться и работать непосредственно с _amoCRM_ напрямую. Иными словами, мы создаем, ведем задачи прямо из дашборда в системе, которая находится далеко за пределами нашей компании. С помощью **HTTP** запросов к API сервиса _amoCRM_ удается создавать, изменять задачи, а также двигать их по статусам, по исполнителям, по суммам и пр. 

Внесем немного ясности, что такое CRM система в целом, и amoCRM в частности? 
##### CRM система 
**CRM (Customer Relationship Management)**  — это система управления взаимоотношениями с клиентами. Она помогает компаниям отслеживать и анализировать информацию о своих клиентах, чтобы улучшить взаимодействие с ними и увеличить прибыль.

**Для чего нужна CRM?**

- **Улучшение качества обслуживания клиентов.** CRM позволяет создавать единую базу данных о клиентах, их потребностях и истории взаимодействий. Это помогает лучше понимать каждого клиента и предлагать ему индивидуальные решения. 
  То есть, условно, где бы не была создана какая-либо задача, или сделка, или любая другая сущность, она попадает в единую базу задач, где распределяется по сотрудникам, которые могут решить эту задачу.
- **Повышение лояльности клиентов.** CRM позволяет выстраивать долгосрочные отношения с клиентами, предоставляя им персонализированные предложения и услуги. 
  То есть владелец компании знает, сколько он уже сотрудничает с каждым конкретным клиентом, и знает, сколько денег он ему принес. На основании этого можно составлять какие-либо персональные скидки и пр.
- **Увеличение продаж.** CRM помогает эффективно управлять продажами, отслеживать прогресс сделок и анализировать эффективность маркетинговых кампаний.
  То есть CRM системы предоставляют некий функционал в плане аналитики. Естественно, это сухие цифры, по типу, всего продаж/сделок, сумма выручки, и пр.
- **Упрощение бизнес-процессов.** CRM автоматизирует рутинные задачи, такие как отправка писем, планирование встреч и составление отчетов, освобождая время сотрудников для более важных задач.
  То есть руководитель пишет письма-комментарии прямо из этой системы своим сотрудникам и назначает, или переназначает эти задачи  напрямую из системы.

**Где применяется CRM?**

CRM применяется практически во всех сферах бизнеса:

- **Розничная торговля.** CRM используется для управления лояльностью клиентов, проведения маркетинговых кампаний и повышения продаж.
- **Финансовые услуги.** Банки и страховые компании используют CRM для управления клиентскими отношениями, отслеживания кредитов, инвестиций и страховых полисов.
- **Телекоммуникации.** CRM позволяет управлять абонентами, предоставлять персональные предложения и решать технические проблемы.
- **IT-сфера.** CRM используется для управления клиентами, поддержки и оказания технической помощи.

CRM является мощным инструментом для любого бизнеса, который хочет улучшить обслуживание клиентов, повысить их лояльность и увеличить прибыль.

##### amoCRM
_amoCRM_, как, на мой взгляд, один из наиболее ярких представителей плеяды различных _crm-систем_. Этой системе доверяют люди. Она внедрена во многих компаниях и для топ-менеджмента по России этот сервис на слуху.

В этой системе есть несколько сущностей, с которыми может работать пользователь. В нашем случае, это:
- **Сделка**: Это то, что в итоге гарантирует нам, как компании, получении прибыли. Говоря в терминах нашей компании, сделкой может быть, например: 
	- Task Mining для ММК, 
	- PM для Ренессанс Жизнь, 
	- мультипроцесс для ЕвроХима
- Также сделка обладает **статусами**. В нашем случае, это:
	- Первичный контакт;
	- Переговоры;
	- Принимают решение;
	- Согласование договра;
	- Успешно реализовано;
	- Закрыто и нереализовано.
- **Задачи**: Это то, что двигает нашу сделку по статусам. Задач может быть множество типов, начиная от назначения встречи, и предела нет, потому что тип задач может создавать сам пользователь. 
- Все эти Сделки и статусы относятся к **Клиентам**. Пользователь самостоятельно создает клиентов. Эти клиенты, это:
	- ФИО клиента, или ответственного лица от компании;
	- Компания, с которой мы работаем;
- **Сумма**: Сумма, за которую наша компания согласна оказать услугу другой компании.

Всем этим можно управлять в системе amoCRM, но **вернемся в процессет**.

Иными словами клиенту нет необходимости выходить из процессета и работать с задачами в другой системе, потом возвращаться, перебивать данные, сводить дебет-с кредетом. Все это делается прямо отсюда.
Также наше система не была бы BI системой, если бы тут не было ни одного графика, диаграммы, показателя, и пр. Но, как вы видите, они тут есть, поэтому давайте пройдемся по ним более детально.

##### Шапка
В шапке расположены такие метрики, как количество сделок, сумма прибыли с успешно закрытых сделок, количество этих самых закрытых сделок, и, наконец, количество компаний, с которыми мы работаем. 
Также вынесены столбчатая диаграмма по динамике сделок, и кольцевая диаграмма по распределению задач по статусам.
В шапке вынесены две кнопки, это кнопка, которая возвращает нас назад к "Главной странице", и кнопка, которая приводит нас на сам сайт amoCRM. 

>**Интерактив** - попробуйте догадаться, где настоящая кнопка, а где кнопка фейк?
##### Таблица
В таблице перечислены активные сделки. Все эти сделки подгружаются непосредственно из системы. Синхронизация по сделкам, задачам, клиентам, статусам происходит каждые 5 минут, и после каждого добавления новой задачи из _Processet_.

Приняли решение подсветить в таблице два интересующих нас поля, это сумма по сделке, и количество времени с последней активности — время бездействия. 

Также отличительной особенностью в этом дашборде является то, что тут _предусмотрена возможность написать_ исполнителю задачи сразу в _telegram_, или на _почту_. При этом в сообщение подтягивается сразу и название сделки, и прикрепляется _ссылка на дашборд_. 
##### Общее
Чтобы уменьшить количество визуального шума и максимально облегчить дашборд сократили количество строк в таблице. 

### Задачи

![[Страница 2(2).png]]

Если на предыдущем дашборде мы показывали возможность работы со сторонней системой, то на этой странице мы показываем возможность работы самой системы в плане работы с задачами, но уже внутренними. Но этой странице мы ведем задачи, храним непосредственно в нашей системе.
Здесь у нас уже появляется возможность более тонко настраивать функционал под себя. Для нас было важно добавить возможность приоритезации задач. И, как вы видите, теперь у нас есть разные приоритеты: _Высокий, Средний, Низкий_.

**Пример:** Представьте, что вам нужно завершить презентацию к завтрашнему дню и провести тренинг для сотрудников в течение недели. В этом случае вы можете присвоить презентации _Высокий приоритет_, а тренингу _Средний_.

Также здесь стоят именно те статусы, какие мы хотим. 
Суть этого дашборда в том, чтобы показать, что благодаря нашей системе можно не только создавать и вести задачи, но и легко приоритезировать эти самые задачи, менять исполнителей и прочее. 

**Пример:** Вы заметили, что одна из ваших задач оказалась неактуальной. Просто измените ее статус на _Отменено_, и она больше не будет отвлекать вас от других дел.

Также нечто интересное тут, это кнопка - "_Рассылка KPI_". Благодаря этой кнопке рассылаются текущие показания по KPI всем участникам некой рассылки, что тоже может быть полезною. Рассылка может идти на почту, или в telegram. Кому как удобно.

Также не могу не рассказать про образу, как как этот отчет построен на системе, где поддерживаются образы. Нажав на кнопку "Просмотр" мы можем более детально исследовать задачи с тем или иным статусом.

В  таблице с задачами решили подсветить также два поля, чтобы излишне не нагромождать страницу. Это поля "_Бездействие_", и "_До дедлайна_".

### Task Mining
Встречайте всем известный и горячо любимый Task Mining на образах. На экране представлено наше видение этого отчета в переложении на образы.

![[Task Mining.png]]

Как видите дашборд получился супер легким, ненавязчивым, воздушным и свободным. Здесь нет даже карты процесса. Но есть такие показатели, как количество операций, сумма часов в год, процентное представление потенциала к оптимизации в год. 
С помощью кнопки "_Получить данные_" дашборд пересчитывается и обновляется. 

Теперь, чтобы более детально изучить все тонкости тех процессов, которые можно оптимизировать, можем нажать на кнопку "_Исследовать_" и получить список карт процессов, и отдельных метрик по выбранным процессам. Их тут 10 штук. 

Таким образом пользователь может детализироваться и обратить внимание именно на ту карту, которая ему нужна. При этом не отвлекаясь ни на что другое. 

### Улучшение Бизнес-процессов
Последняя страница дашборда — "_Улучшение Бизнес-процессов_". В чем философия и суть этой страницы? В том, чтобы компания-клиент могла получать обратную связь о своей работе от своих же сотрудников. Каждый сотрудник может зайти сюда, и создать запись, в которой он может предложить улучшение какого-либо бизнес-процесс. При этом другие сотрудники могут проголосовать за понравившуюся идею и "протолкнуть" ее выше. 
Там уже руководство может принять эту идею, и ввести ее на уровне компании, либо забраковать.

Также, как вы видите, приведена кое-какая аналитика, которая радует глаз. Видно, что сотрудники нашей компании _N_ заинтересованы в ее росте и развитии.

## Подкапотное пространство
Теперь окунемся в мир подкапотного пространства. Поверьте, там есть нечто удивительное.
Наше изучение "подкапотки" начинается с со скриптов, которые _обслуживают_ дашборд "CRM Сделки".

### CRM Сделки
Для обеспечения работы функционала системы было написано 8 скриптов. Мы не будем останавливаться на базовых скриптах отправки писем или сообщений в telegram. Покажу только самые интересные на мой взгляд. Начнем со скрипта "_1. Получить справочник компаний_". 
#### 1. Получить справочник компаний
Если пробежаться по всей структуре скрипта, то она будет выглядеть так:
1. _Ручной запуск_ - База;
2. _Данные для входа_ - здесь я получаю данные для входя из таблицы. Данные для входа (авторизации) в систему amoCRM. 
3. _Создание таблицы crm_companies_table_ - при каждом новом запуске скрипта я заново создаю и заполняю таблицу-справочник по контрагентам.  Сделано это для того, чтобы мы могли каждый раз получать актуальный список контрагентов. 
	- _Почему не динамическая подливка данных?_ Потому что такое часто бывает, что в amoCRM меняют данные по контрагентам, дополняют и меняют контакт. Для того, чтобы минимизировать влияние этого фактора решил использовать такой подход. 
4. _Вернуть данные о компании_ - это JS блок, в котором я забираю данные о компаниях. Здесь идет обращение к API amoCRM, в котором мы передаем авторизационные данные, передаем метод _companies_.  Соответственно, получаю все данные по всем компаниям, после этого "_парсю_" их, и забираю только то, что мне нужно. А именно - id компании, и ее название. Для моих нужд этого вполне достаточно.
5. _Разгруппировать массив_ - чтобы мы могли обращаться полученным элементам массива.
6. _Добавить строки_ - Добавляем строки в ранее созданную таблицу.

#### 1. Получить сделки и обновить компании
Скрипт выглядит так. Здесь не будем проходить по всех блокам, только по самым интересным.

**Блок выполнения скрипта** - это нововведение в нашей системе и мы решили его попробовать. Работает классно. Тут все просто. В выпадающем списке выбираем скрипт, который есть в нашем пространстве.
Вся суть и плюс этого блока в том, что больше не нужно заводить ключи API. Больше не нужно вычленять GraphQL запрос и прочеею Тут есть один блок, который перекрывает эту потребность.

**JS - Забрать данные** - Забираем данные с API сайта. Также получаем все данные, что есть. Но в блоке JS мы парсим то, что есть, чтобы привести данные в тот вид, который мне нужно
```js
    parsed_data.push(
      {
        'id': current_lead['id'],
        'name': current_lead['name'],
        'price': current_lead['price'],
        'responsible_user_id': current_lead['responsible_user_id'],
        'status_id': current_lead['status_id'],
        'created_at': current_lead['created_at'],
        'updated_at': current_lead['updated_at'],
        'closed_at': current_lead['closed_at'],
        'company_id': company_id
      }
    )
```

#### 1. Получить все задачи из amoCRM
Здесь из интересного обращение к API сайта, но мы это уже видели. Так что не будем останавливаться.

#### Синхронизация данных
В целом это дубль тех скриптов, что были выше, но с той лишь разницей, что тут используется не ручной запуск, а планировщик, заряженный на каждые 5 минут.

#### 1. Создать задачу в CRM
Нечто по настоящему новое и интересное в этом скрипте. Это блок пользовательских интеграций. Что это такое?

Те, кто знаком с парадигмой ООП могут провести аналогию с классом и его методами. Иными словами, с помощью блока пользовательских интеграций можно один раз прописать какой-либо метод и переиспользовать его столько раз, сколько нужно, при этом больше не лезть в код. Новые данные в код передаются через маппинг полей. 
В сущности, блок пользовательских интеграций, это ничто иное, как большой блок _JavaScript_, или даже _JSON_, в котором в определенной структуре расположены строительные блоки-кирпичики будущей интеграции.
При написании кода к интеграции мы прописываем те поля, которые будут тянуться внутри кода. И все такое.

Ниже расположены уже известные нам блоки запуска скрипта. То есть я запускаю те скрипты, которые синхронизируют данные на стороне сервиса, и нашей системы, делая при этом, как бы единый инструмент.

### Задачи
Из нового тут, наверное, ничего нет, так что мы не будем останавливаться на этой пачке скриптов.

### Task Mining
Здесь хотелось бы подсветить сразу несколько моментов.
1. **Перерасчет данных** - так, как главной задачей презентации на митапе было ничто иное, как показать работоспособность системы и добиться ВАУ эффекта, был придуман такой способ:
   - Добавил флаг активности в таблицу _OperationCases_;
   - Рандомно присвоил этому флагу значения 0 или 1;
   - В BI скрыл все те строки, добавленное поле в которых не содержит  1;
2. Написал скрипт, который **превращает нули из добавленного поля — в 1**;
   Таким образом создается ощущение того, что мы подлили новые данные.
3. **Создание виджета скриптом**. Знаю, что тема не новая, но хотел показать мое видение такого рода скриптов, которые способны генерировать новые образы с таким наполнением, какое мы хотим
	   Главным подходом здесь было обращение к функциям и циклам. Где изначально у нас есть одна переменная, в которой хранится тело для YAML. При этом мы знаем, как выглядит то, что мы хотим. 
	   Прописал две функции для генерации текста блока YAML. Потом просто "приклеил" полученный текст к пустой шапке и все готово.
	   Отличие от скрипта Саши Б в том, что он присваивает полученные блоки константе сразу, а у меня это динамично составленный текст, который встаривается в уже готовую пустую заготовку YAML кода.
	   Скорей всего мы придерживаемся одних и тех же принципов, но мне показался мой подход чуть легче и чуть более читаемым.

### Улучшение бизнес-процессов
Тут также нет ничего нового и интересного для нас.


